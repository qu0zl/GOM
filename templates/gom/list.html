{% extends "site_base.html" %}

{% load i18n %}
{% block extra_head %}
<link rel="stylesheet" href="{{ STATIC_URL }}tsThemes/blue/style.css" type="text/css" id="" media="print, projection, screen" />
<script src="{{ STATIC_URL }}js/jquery.tablesorter.min.js"></script>
<script src="{{ STATIC_URL }}js/jquery.form.js"></script>
<script type="text/javascript">
    function filter (e) {
        $.post( '/gom/list/filter/', 
                { owner: $('#id_filter_owner').val(), manu:$('#id_filter_manu').val(), unit_type:$('#id_filter_unit_type').val(),
                cost_min: $('#id_filter_cost_min').val(), cost_max: $('#id_filter_cost_max').val(), image: $('#id_filter_image').val(),
                rating_min: $('#id_filter_rating_min').val(),},
        function( data ) {
            $("#id_list_table" ).empty().append( data );
            $("#id_unit_table").trigger("update");
        });
        e.preventDefault();
    }
    function forceUpdate(e){
        $('#multi_PDF').ajaxSubmit({url:'/gom/list/addForceEntry/',
            success: function(){ 
            $('select[name^="force_"]').val('');
            $('#id_force').html("{% trans "Done" %}").delay('slow').queue(function(n) {
                            $(this).html("{% trans "Add to Force" %}");
                            n();})
            },});
    e.preventDefault();
    }
    $(document).ready(function() { 
        $.ajaxSetup ({
            cache: false
            });
        $('#id_force').click(forceUpdate);
        $("#id_unit_table").tablesorter({sortList: [[1,0],[0,0]], headers:
            { 5: { sorter: false }, 6: { sorter: false } } });
        $('select[id^="id_filter_"]').change(filter);
    } 
    ); 
</script>
{% endblock extra_head %}

{% load ifsetting_tag %}

{% block head_title %}{% trans "List Units" %}{% endblock %}

{% block body %}
<h1>{% trans "Units" %}</h1>
<div>
<h4>Filter by: 
<select style="width:110px;" id="id_filter_owner" name="filter_owner">
    <option value="" selected="selected">{% trans 'Owner' %}</option>
    {% for user in owners %}
    <option value="{{user.id}}">{{user}}</option>
    {% endfor %}
</select>
<select style="width:110px;" id="id_filter_unit_type" name="filter_unit_type">
    <option value="" selected="selected">{% trans 'Unit Type' %}</option>
    <option value="1">{% trans 'Grunt Squad' %}</option>
    <option value="2">{% trans 'Squad Attachment' %}</option>
    <option value="3">{% trans 'Specialist' %}</option>
    <option value="4">{% trans 'Commander' %}</option>
    <option value="11">{% trans 'Tank' %}</option>
    <option value="12">{% trans 'Mecha' %}</option>
    <option value="13">{% trans 'GSV' %}</option>
    <option value="14">{% trans 'ASV' %}</option>
    <option value="15">{% trans 'Artillery' %}</option>
</select>
<select style="width:120px;" id="id_filter_manu" name="filter_manu">
    <option value="" selected="selected">{% trans 'Manufacturer' %}</option>
    {% for manu in manufacturers %}
    <option value="{{manu.id}}">{{manu.manuName}}</option>
    {% endfor %}
</select>
<select style="width:110px;" id="id_filter_cost_min" name="filter_cost_min">
    <option value="" selected="selected">{% trans 'Min Cost' %}</option>
    <option value="5">>=5</option>
    <option value="10">>=10</option>
    <option value="15">>=15</option>
    <option value="20">>=20</option>
    <option value="25">>=25</option>
    <option value="30">>=30</option>
    <option value="40">>=40</option>
    <option value="50">>=50</option>
</select>
<select style="width:110px;" id="id_filter_cost_max" name="filter_cost_max">
    <option value="" selected="selected">{% trans 'Max Cost' %}</option>
    <option value="5"><=5</option>
    <option value="10"><=10</option>
    <option value="15"><=15</option>
    <option value="20"><=20</option>
    <option value="25"><=25</option>
    <option value="30"><=30</option>
    <option value="40"><=40</option>
    <option value="50"><=50</option>
</select>
<select style="width:110px;" id="id_filter_rating_min" name="filter_rating_min">
    <option value="" selected="selected">{% trans 'Min Rating' %}</option>
    <option value="2">>=2</option>
    <option value="3">>=3</option>
    <option value="4">>=4</option>
    <option value="4.5">>=4.5</option>
</select>
<select style="width:110px;" id="id_filter_image" name="filter_image">
    <option value="" selected="selected">{% trans 'Image' %}</option>
    <option value="1">{% trans 'Has Image' %}</option>
    <option value="2">{% trans 'No Image' %}</option>
</select>
</h4>
</div>

{% if units %}

<form method="post" id="multi_PDF" action="/gom/list/handle/" enctype="multipart/form-data"> {% csrf_token %}
<table id="id_unit_table">
<thead> 
<tr> 
    <th>{% trans 'Name' %}</th> 
    <th>{% trans 'Owner' %}</th> 
    <th>{% trans 'Cost' %}</th>
    <th>{% trans 'Manufacturer' %}</th>
    <th>{% trans 'Rating' %}</th>
    <th><button name="pdf" type="submit">{% trans "Create Multi Card PDF" %}</button></th>
    {% if user.is_authenticated %}
    <th><button id="id_force" name="force" type="submit">{% trans "Add to Force" %}</button></th>
    {% else %}
    <th>{% trans "Add to Force" %}</th>
    {% endif %}
</tr> 
</thead> 
    <tbody id="id_list_table">
    {% include 'gom/list_table.html' %}
    </tbody>
</table>
{% endif %}
</form>
{% endblock %}
